{% extends "base.html" %}
{% block content %}
<h2>Payment for Order #{{ order.id }}</h2>
<p>Total: ${{ order.total_price }}</p>

<script src="https://js.stripe.com/v3/"></script>

<button id="pay-btn">Pay Now</button>

<script>
const stripe = Stripe('{{ STRIPE_PUBLIC_KEY }}');
const payBtn = document.getElementById('pay-btn');

payBtn.addEventListener('click', () => {
    stripe.confirmCardPayment('{{ client_secret }}', {
        payment_method: {
            card: {token: 'tok_visa'} // For test, use Stripe test token
        }
    }).then(function(result) {
        if (result.error) {
            alert(result.error.message);
        } else {
            if (result.paymentIntent.status === 'succeeded') {
                alert('Payment Successful!');
                window.location.href = "{% url 'orders:order_success' order.id %}";
            }
        }
    });
});
</script>
{% endblock %}
